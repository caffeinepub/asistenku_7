{
  "kind": "build_request",
  "title": "Wire Superadmin Claim Flow to Internal Login UI (Strict File/Scope Constraints)",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "In `backend/main.mo`, ensure the following methods exist with exactly these signatures (stable/public API):\n- `public query func hasSuperadmin() : async Bool`\n- `public shared({caller}) func claimSuperadmin() : async { ok: Bool; message: Text }`\n\nImplement behavior:\n- If no superadmin exists yet: set `caller` as the superadmin and mark it ACTIVE immediately (no name/email/WhatsApp requirements); return `{ ok = true; message = <non-empty success text> }`.\n- If a superadmin already exists and `caller` is that superadmin: return `{ ok = true; message = <idempotent success text> }`.\n- If a superadmin already exists and `caller` is not the superadmin: return `{ ok = false; message = <non-empty error text> }`.\n\nDo not add any required fields for superadmin such as name/email/WhatsApp.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Step 2 — Backend (pastikan method final) Di backend/main.mo, pastikan method ini ADA dan signature stabil:\npublic query func hasSuperadmin() : async Bool\npublic shared({caller}) func claimSuperadmin() : async { ok: Bool; message: Text }\nPerilaku:\nJika belum ada superadmin: set principal caller sebagai superadmin dan langsung ACTIVE (tanpa form nama/email/WA), return {ok=true}\nJika sudah ada dan caller adalah superadmin: idempotent {ok=true}\nJika sudah ada dan caller bukan superadmin: {ok=false}\nJangan tambahkan field wajib nama/email/WhatsApp untuk superadmin."
        ]
      },
      "acceptanceCriteria": [
        "Calling `hasSuperadmin()` returns `false` on a fresh deployment with no prior superadmin.",
        "First call to `claimSuperadmin()` from principal A returns `{ ok=true }` and causes `hasSuperadmin()` to return `true` afterwards.",
        "Second call to `claimSuperadmin()` from principal A returns `{ ok=true }` (idempotent).",
        "Call to `claimSuperadmin()` from principal B after A has claimed returns `{ ok=false }` and does not change the current superadmin.",
        "Both methods compile and are exported from the canister with the exact specified signatures."
      ]
    },
    {
      "id": "REQ-2",
      "text": "In the existing Internal Login page file `frontend/src/pages/internal/InternalLogin.tsx`, add a \"Claim Superadmin\" UI block tied to the backend methods.\n\nOn page load:\n- Call `actor.hasSuperadmin()`.\n- Store state as `hasSuperadmin: boolean | null`.\n- While `hasSuperadmin === null`, show a small loading indicator.\n\nRendering rules:\n- If `hasSuperadmin === false`, render a card at the top of the role grid (or immediately before the grid) with:\n  - Title: \"Claim Superadmin\"\n  - Description: \"Only available once. After it is claimed, this card disappears.\"\n  - Button: \"Claim Superadmin\"\n- If `hasSuperadmin === true`, do not render the card at all.\n\nInteraction:\n- The user must complete Internet Identity login first (keep the existing Internet Identity login button behavior intact), then they can click \"Claim Superadmin\" (if shown).\n- On clicking the button, call `actor.claimSuperadmin()`.\n  - If `ok === true`, refresh `hasSuperadmin` by calling `actor.hasSuperadmin()` again (or perform a light page reload limited to this page).\n  - If `ok === false`, display the backend `message` as an error.\n\nUI wording constraint:\n- Do not use the word \"service\" or \"Service\" anywhere on this page.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "Step 3 — Frontend (aktifkan card Claim Superadmin di internal login) Di halaman “Masuk Internal” ... tambahkan blok UI berikut:\nSaat halaman load:\npanggil actor hasSuperadmin()\nsimpan state hasSuperadmin: boolean | null\n...\nJika hasSuperadmin === false:\ntampilkan sebuah card ... judul: “Claim Superadmin”\n... tombol: “Claim Superadmin”\n...\nJika hasSuperadmin === true:\ncard Claim Superadmin tidak tampil sama sekali.\nJangan ubah perilaku tombol login Internet Identity yang sudah ada, tapi pastikan urutan UX aman:\nuser login II dulu (tetap),\nlalu bisa klik “Claim Superadmin” (jika card tampil)."
        ]
      },
      "acceptanceCriteria": [
        "When visiting `/internal/login` while no superadmin exists, after Internet Identity login completes, the \"Claim Superadmin\" card is visible and enabled.",
        "Clicking \"Claim Superadmin\" successfully claims and then the card disappears without navigating away from `/internal/login`.",
        "When a superadmin already exists, the \"Claim Superadmin\" card never renders.",
        "On a failed claim attempt, the UI surfaces the exact `message` returned by the backend.",
        "No new usage of the word \"service\"/\"Service\" appears in the Internal Login page UI text.",
        "Existing role cards (Admin, Asistenmu, Concierge, Strategic Partner, Manajer, Finance, Management) and their existing behavior remain unchanged aside from positioning due to the new card."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Update the single existing frontend canister binding/helper file `frontend/src/hooks/useActor.ts` (or equivalent within that same file only) so the Internal Login page can safely call `hasSuperadmin()` and `claimSuperadmin()` on the backend actor after Internet Identity login.\n\nThis must be done without global refactors and without changing routing; limit changes strictly to enabling these method calls from the Internal Login page.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "File yang boleh disentuh HANYA:\nbackend/main.mo\n1 file halaman internal login...\n1 file helper actor/frontend binding (misalnya frontend/src/hooks/useActor.ts atau file setara yang memanggil canister)\n\nFokus hanya menghubungkan fitur claim superadmin ke UI internal login."
        ]
      },
      "acceptanceCriteria": [
        "Internal Login can obtain a non-null actor after Internet Identity login and successfully call `hasSuperadmin()` and `claimSuperadmin()` through the existing actor creation flow.",
        "No other pages/components are modified and there is no routing change beyond relying on the existing `/internal/login` route.",
        "Changes are confined to the allowed single helper binding file and do not introduce app-wide refactors."
      ]
    }
  ],
  "constraints": [
    "Do not modify anything in the landing page or any Asistenku landing components.",
    "Do not modify any client pages or partner pages.",
    "Do not perform any global refactors.",
    "Do not change routing other than adding/ensuring the existing internal login route remains available; do not alter other routes.",
    "Focus only on connecting the superadmin claim feature to the Internal Login UI.",
    "Do not use the word \"service\" or \"Service\" anywhere in the UI.",
    "Only the following files may be modified: `backend/main.mo`, `frontend/src/pages/internal/InternalLogin.tsx`, and exactly one frontend actor/binding helper file (e.g., `frontend/src/hooks/useActor.ts`)."
  ],
  "nonGoals": [
    "Adding or changing any landing page visuals/content.",
    "Adding superadmin registration forms or requiring name/email/WhatsApp for superadmin.",
    "Building out role workspaces/dashboards beyond the existing placeholder behavior.",
    "Introducing new auth providers or third-party authentication beyond Internet Identity.",
    "Refactoring the access control system or rewriting existing backend modules beyond what is necessary to add the two required methods."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}